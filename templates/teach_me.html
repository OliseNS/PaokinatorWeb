{% extends "layout.html" %}

{% block content %}
    <h2>Teach Me About {{ animal | title }}!</h2>
    <p>You know this {{ domain | lower }}, right? Answer these 5 quick questions to help me learn more about the <strong>{{ animal }}</strong>.</p>

    <form action="{{ url_for('submit_teaching') }}" method="POST" style="display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 500px; margin: 0 auto;">
        
        <input type="hidden" name="animal_name" value="{{ animal }}">
        <input type="hidden" name="domain_name" value="{{ domain }}">

        {% if features %}
            {% for feature in features %}
            <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 10px; margin-bottom: 25px; width: 100%; padding: 20px; background: white; border: 2px solid #e5e5e5; border-radius: 12px;">
                
                <input type="hidden" name="feature_name_{{ loop.index0 }}" value="{{ feature.feature_name }}">
                <input type="hidden" name="question_{{ loop.index0 }}" value="{{ feature.question }}">

                <label for="answer_{{ loop.index0 }}" style="font-weight: 600; font-size: 1.1rem; margin-bottom: 10px;">{{ feature.question }}</label>
                
                <div class="answer-buttons" data-group="{{ loop.index0 }}" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                    <button type="button" class="btn answer-btn" data-value="yes">Yes</button>
                    <button type="button" class="btn answer-btn" data-value="mostly">Mostly</button>
                    <button type="button" class="btn answer-btn" data-value="sort of" style="grid-column: 1 / -1;">Sometimes</button>
                    <button type="button" class="btn answer-btn" data-value="not really">Not really</button>
                    <button type="button" class="btn answer-btn" data-value="no">No</button>
                    <button type="button" class="btn answer-btn" data-value="idk" style="grid-column: 1 / -1; background-color: #f0f0f0;"> ¯\_(ツ)_/¯ I Don't Know</button>
                </div>
                <input type="hidden" name="answer_{{ loop.index0 }}" id="answer_{{ loop.index0 }}" value="idk">
            </div>
            {% endfor %}
            
            <button type="submit" class="btn btn-primary" style="margin-top: 10px; width: 100%;">Submit Answers</button>
        
        {% else %}
            <p>I couldn't find any questions to ask about the {{ animal }}.</p>
            <a href="{{ url_for('index') }}" class="btn">Back to Home</a>
        {% endif %}

    </form>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const answerButtonGroups = document.querySelectorAll('.answer-buttons');

    answerButtonGroups.forEach(group => {
        const hiddenInput = document.getElementById(`answer_${group.dataset.group}`);
        
        // Set default selection
        const defaultButton = group.querySelector('.answer-btn[data-value="idk"]');
        if (defaultButton) {
            defaultButton.classList.add('selected');
        }

        group.addEventListener('click', (event) => {
            const target = event.target.closest('.answer-btn');
            if (!target) return;

            const selectedValue = target.dataset.value;
            hiddenInput.value = selectedValue;

            // Update visual selection
            group.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.style.border = "1.5px solid #e5e5e5";
            });
            target.classList.add('selected');
            target.style.border = "2px solid #4A55A2";
        });
    });
});
</script>

<style>
    .answer-btn.selected {
        border: 2px solid #4A55A2;
        background-color: #eef0ff;
    }
</style>

{% endblock %}